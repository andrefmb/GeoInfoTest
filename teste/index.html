
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://github.com/andrefmb/GeoInfoTest/teste/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.4">
    
    
      
        <title>Teste - Informações Georreferenciadas</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/printing.css">
    
      <link rel="stylesheet" href="../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../css/pandas-dataframe.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="pink">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#createdataframe" class="md-skip">
          Ir para o conteúdo
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Informações Georreferenciadas" class="md-header__button md-logo" aria-label="Informações Georreferenciadas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Informações Georreferenciadas
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Teste
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/andrefmb/GeoInfoTest/" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GeoInfoTest
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Informações Georreferenciadas" class="md-nav__button md-logo" aria-label="Informações Georreferenciadas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Informações Georreferenciadas
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/andrefmb/GeoInfoTest/" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GeoInfoTest
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Aulas
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Aulas" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Aulas
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Teste
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Teste
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#createdataframe" class="md-nav__link">
    createDataFrame()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#take" class="md-nav__link">
    take()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#row" class="md-nav__link">
    Row()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asdict" class="md-nav__link">
    asDict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rdd" class="md-nav__link">
    RDD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acessando-o-dataframe" class="md-nav__link">
    Acessando o DataFrame
  </a>
  
    <nav class="md-nav" aria-label="Acessando o DataFrame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#show" class="md-nav__link">
    show()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#printschema" class="md-nav__link">
    printSchema()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dtypes" class="md-nav__link">
    dtypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#definindo-o-schema" class="md-nav__link">
    Definindo o Schema
  </a>
  
    <nav class="md-nav" aria-label="Definindo o Schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structtype-structfield-integertype-stringtype-floattype" class="md-nav__link">
    StructType(), StructField(), IntegerType(), StringType(), FloatType()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operacoes-basicas-com-colunas" class="md-nav__link">
    Operações básicas com colunas
  </a>
  
    <nav class="md-nav" aria-label="Operações básicas com colunas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#columns" class="md-nav__link">
    columns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withcolumnrenamed" class="md-nav__link">
    withColumnRenamed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop" class="md-nav__link">
    drop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acessando-colunas" class="md-nav__link">
    Acessando colunas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    select()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-sensitivity" class="md-nav__link">
    Case sensitivity
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operacoes-basicas-com-linhas" class="md-nav__link">
    Operações básicas com linhas
  </a>
  
    <nav class="md-nav" aria-label="Operações básicas com linhas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#limit" class="md-nav__link">
    limit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter-filtrando-linhas" class="md-nav__link">
    filter() - filtrando linhas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where-filtrando-linhas" class="md-nav__link">
    where() - filtrando linhas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distinct-filtrando-valores-distintos" class="md-nav__link">
    distinct() - filtrando valores distintos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union-concatenando-linhas" class="md-nav__link">
    union() - concatenando linhas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orderby-ordenando-linhas" class="md-nav__link">
    orderBy() - ordenando linhas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pysparksqlfunctions" class="md-nav__link">
    pyspark.sql.functions
  </a>
  
    <nav class="md-nav" aria-label="pyspark.sql.functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lit-criando-colunas" class="md-nav__link">
    lit() - criando colunas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withcolumn-adicionando-colunas" class="md-nav__link">
    withColumn() - adicionando colunas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#col-acessando-colunas" class="md-nav__link">
    col() - acessando colunas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alias" class="md-nav__link">
    alias()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expressoes" class="md-nav__link">
    Expressões
  </a>
  
    <nav class="md-nav" aria-label="Expressões">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expr" class="md-nav__link">
    expr()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selectexpr" class="md-nav__link">
    selectExpr()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#abrindo-arquivos-csv" class="md-nav__link">
    Abrindo arquivos CSV
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#createdataframe" class="md-nav__link">
    createDataFrame()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#take" class="md-nav__link">
    take()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#row" class="md-nav__link">
    Row()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asdict" class="md-nav__link">
    asDict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rdd" class="md-nav__link">
    RDD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acessando-o-dataframe" class="md-nav__link">
    Acessando o DataFrame
  </a>
  
    <nav class="md-nav" aria-label="Acessando o DataFrame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#show" class="md-nav__link">
    show()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#printschema" class="md-nav__link">
    printSchema()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dtypes" class="md-nav__link">
    dtypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#definindo-o-schema" class="md-nav__link">
    Definindo o Schema
  </a>
  
    <nav class="md-nav" aria-label="Definindo o Schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structtype-structfield-integertype-stringtype-floattype" class="md-nav__link">
    StructType(), StructField(), IntegerType(), StringType(), FloatType()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operacoes-basicas-com-colunas" class="md-nav__link">
    Operações básicas com colunas
  </a>
  
    <nav class="md-nav" aria-label="Operações básicas com colunas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#columns" class="md-nav__link">
    columns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withcolumnrenamed" class="md-nav__link">
    withColumnRenamed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop" class="md-nav__link">
    drop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acessando-colunas" class="md-nav__link">
    Acessando colunas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    select()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-sensitivity" class="md-nav__link">
    Case sensitivity
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operacoes-basicas-com-linhas" class="md-nav__link">
    Operações básicas com linhas
  </a>
  
    <nav class="md-nav" aria-label="Operações básicas com linhas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#limit" class="md-nav__link">
    limit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter-filtrando-linhas" class="md-nav__link">
    filter() - filtrando linhas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where-filtrando-linhas" class="md-nav__link">
    where() - filtrando linhas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distinct-filtrando-valores-distintos" class="md-nav__link">
    distinct() - filtrando valores distintos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union-concatenando-linhas" class="md-nav__link">
    union() - concatenando linhas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orderby-ordenando-linhas" class="md-nav__link">
    orderBy() - ordenando linhas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pysparksqlfunctions" class="md-nav__link">
    pyspark.sql.functions
  </a>
  
    <nav class="md-nav" aria-label="pyspark.sql.functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lit-criando-colunas" class="md-nav__link">
    lit() - criando colunas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withcolumn-adicionando-colunas" class="md-nav__link">
    withColumn() - adicionando colunas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#col-acessando-colunas" class="md-nav__link">
    col() - acessando colunas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alias" class="md-nav__link">
    alias()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expressoes" class="md-nav__link">
    Expressões
  </a>
  
    <nav class="md-nav" aria-label="Expressões">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expr" class="md-nav__link">
    expr()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selectexpr" class="md-nav__link">
    selectExpr()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#abrindo-arquivos-csv" class="md-nav__link">
    Abrindo arquivos CSV
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/andrefmb/GeoInfoTest/edit/master/docs/teste.ipynb" title="Editar esta página" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var scriptElement = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    scriptElement.src = widgetRendererSrc;
    document.body.appendChild(scriptElement);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Setar o ambiente para uso de Python no Spark</span>
<span class="kn">import</span> <span class="nn">support_functions</span> <span class="k">as</span> <span class="nn">sf</span>
<span class="n">sf</span><span class="o">.</span><span class="n">set_spark_python</span><span class="p">()</span>

<span class="c1"># Criar a sessao do Spark</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span> \
            <span class="o">.</span><span class="n">builder</span> \
            <span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="s2">&quot;local[2]&quot;</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;AndreDF&quot;</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">spark</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea output_execute_result">

            <div>
                <p><b>SparkSession - in-memory</b></p>

        <div>
            <p><b>SparkContext</b></p>

            <p><a href="http://ip-172-31-39-225.ec2.internal:4041">Spark UI</a></p>

            <dl>
              <dt>Version</dt>
                <dd><code>v3.0.1</code></dd>
              <dt>Master</dt>
                <dd><code>local[2]</code></dd>
              <dt>AppName</dt>
                <dd><code>AndreDF</code></dd>
            </dl>
        </div>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>

</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sc</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Até agora vimos trabalhando com a estrutura base do Spark, as RDDs. Contudo, essas estruturas são trabalhosas e requerem o tratamento manual de tipos de dados bem como a interpretação constante dos dados posicionais na RDD.</p>
<p>É possível simplificar nosso trabalho com o uso de camadas novas e mais elevadas do Spark.</p>
<p>Existe uma série de funções para a criação e a criação e manipulação destas novas estruturas de dados. Vamos começar investigando os DataFrames, inspirados na biblioteca Pandas do Python.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="createdataframe">createDataFrame()<a class="headerlink" href="#createdataframe" title="Permanent link">&para;</a></h2>
<p>Para criar um DataFrame a partir de uma RDD, podemos utilizar a função <code>createDataFrame(RDD)</code>. É importante notar que o ponto de entrada das APIs de dados estruturados não é mais o <code>sparkContext</code>, mas diretamente a <code>SparkSession</code> acessível a partir da nossa variável <code>spark</code>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">dept</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;Finance&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="s2">&quot;Marketing&quot;</span><span class="p">,</span><span class="mi">20</span><span class="p">),(</span><span class="s2">&quot;Sales&quot;</span><span class="p">,</span><span class="mi">30</span><span class="p">),(</span><span class="s2">&quot;IT&quot;</span><span class="p">,</span><span class="mi">40</span><span class="p">)]</span>

<span class="n">rdd</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">dept</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">rdd</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[(&#39;Finance&#39;, 10), (&#39;Marketing&#39;, 20), (&#39;Sales&#39;, 30), (&#39;IT&#39;, 40)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">rdd</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>DataFrame[_1: string, _2: bigint]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>DataFrame[_1: string, _2: bigint]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Verificamos que a variável é do tipo DataFrame com colunas com nome <code>_1, _2,</code> e diferentes tipos, já <strong>inferidos</strong> pelo Spark na criação do DataFrame a partir da RDD.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="take">take()<a class="headerlink" href="#take" title="Permanent link">&para;</a></h2>
<p>Podemos então utilizar a função take para verificar nosso DataFrame.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[Row(_1=&#39;Finance&#39;, _2=10),
 Row(_1=&#39;Marketing&#39;, _2=20),
 Row(_1=&#39;Sales&#39;, _2=30),
 Row(_1=&#39;IT&#39;, _2=40)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>É interessante observar que a função nos mostra uma RDD e não um DataFrame. Essa RDD é composta de objetos do tipo Row, ou então linha. Isso é, um DataFrame nada mais é do que uma RDD onde cada elemento é uma linha de uma tabela com suas diferentes colunas. </p>
<p>Diferentemente das RDDs padrões, contudo, os objetos Row grava consigo os nomes e os tipos das colunas e o Spark mantém a gestão garantindo que um mesmo DataFrame seja composto de linhas do mesmo tipo.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="row">Row()<a class="headerlink" href="#row" title="Permanent link">&para;</a></h2>
<p>Podemos manualmente criar uma linha, a partir da classe Row.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">Row</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Para isso precisamos nomear as colunas e seus valores.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">Row</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">11</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>Row(name=&#39;Alice&#39;, age=11)</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Mais tarde entenderemos como concatenar diferentes objetos Row em um DataFrame.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="asdict">asDict()<a class="headerlink" href="#asdict" title="Permanent link">&para;</a></h2>
<p>Podemos transformar objetos do tipo Row em dicionários no python. </p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[Row(_1=&#39;Finance&#39;, _2=10), Row(_1=&#39;Marketing&#39;, _2=20)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Para isso, vamos inicialmente guardar duas linhas de nosso DataFrame.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">rows</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Na sequencia utilizamos a função asDict()</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">my_dict</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asDict</span><span class="p">()</span>
<span class="n">my_dict</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>{&#39;_1&#39;: &#39;Finance&#39;, &#39;_2&#39;: 10}</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Com isso podemos acessar os valores de cada coluna normalmente como um dicionário.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;_1&#39;</span><span class="p">]</span> 
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&#39;Finance&#39;</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="rdd">RDD<a class="headerlink" href="#rdd" title="Permanent link">&para;</a></h2>
<p>O atributo rdd do DataFrame também nos dá acesso direto à RDD fundamental que constrói o DataFrame.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">rdd</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>MapPartitionsRDD[33] at javaToPython at NativeMethodAccessorImpl.java:0</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Nessa RDD podemos aplicar todas as transformações e ações que aprendemos, desde que respeitando o tipo do elemento Row.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[Row(_1=&#39;Finance&#39;, _2=10), Row(_1=&#39;Marketing&#39;, _2=20)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="acessando-o-dataframe">Acessando o DataFrame<a class="headerlink" href="#acessando-o-dataframe" title="Permanent link">&para;</a></h1>
<p>A ideia de termos um DataFrame, contudo, é não precisarmos operar diretamente nas RDDs. Para isso existe um conjunto de funções de acesso direto ao DataFrame. Como estas funções operam intrinsecamente em RDDs, elas também são transformações e ações.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="show">show()<a class="headerlink" href="#show" title="Permanent link">&para;</a></h2>
<p>A ação show() nos permite olhar o DataFrame como uma tabela, muito mais próximo do Pandas DataFrame. Cuidado, contudo, com o desejo de olhar o DataFrame completo.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------+---+
|       _1| _2|
+---------+---+
|  Finance| 10|
|Marketing| 20|
|    Sales| 30|
|       IT| 40|
+---------+---+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="printschema">printSchema()<a class="headerlink" href="#printschema" title="Permanent link">&para;</a></h2>
<p>A ação show() não nos mostra claramente qual é o tipo dos dados envolvidos (similar a dtypes). Para isso, podemos imprimir o Schema do DataFrame. </p>
<p>O Schema é a definição do tipo de dado de cada coluna. É importante notar que o Spark inferiu esses dados a partir da RDD. O Spark infere a partir do primeiro elemento nos dados. Portanto, é importante que na leitura de arquivos, caso a inferência seja utilizada, garantir que a primeira linha do arquivo possua o tipo correto.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>root
 |-- _1: string (nullable = true)
 |-- _2: long (nullable = true)

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="dtypes">dtypes<a class="headerlink" href="#dtypes" title="Permanent link">&para;</a></h2>
<p>Podemos também utilizar o atributo dtypes para mostrar o tipo de cada coluna.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">dtypes</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[(&#39;_1&#39;, &#39;string&#39;), (&#39;_2&#39;, &#39;bigint&#39;)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="definindo-o-schema">Definindo o Schema<a class="headerlink" href="#definindo-o-schema" title="Permanent link">&para;</a></h1>
<p>Idealmente, quando operando em grandes massas de dados, a inferência do tipo pela primeira linha não é adequada e utilizamos como boa prática a definição manual do schema. Para isso precisamos utilizar os tipos de dados nativos do Spark que são convertidos para e de tipos python pela API pyspark.</p>
<p>Para isso importamos os tipos do spark.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="structtype-structfield-integertype-stringtype-floattype">StructType(), StructField(), IntegerType(), StringType(), FloatType()<a class="headerlink" href="#structtype-structfield-integertype-stringtype-floattype" title="Permanent link">&para;</a></h2>
<p>Cada tipo de variável é na verdade um objeto de uma classe. Então acessamos estes objetos para instanciar e para identificar os tipos de cada variável. </p>
<p>O Schema de um DataFrame é definido como um objeto StructType (similar a uma lista ou tupla) com campos do tipo StructField(). Cada campo (StructField) possui um nome, um tipo (objeto do tipo no spark) e um flag se é permitida a existência de nulos. </p>
<p>Assim, podemos definir explicitametne um Schema para nosso DataFrame.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">my_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span> \
                       <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;dept_name&#39;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span> \
                       <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;dept_id&#39;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span> \
                       <span class="p">])</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Na sequencia, atribuímos o nosso schema ao DataFrame na sua criação.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf1</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">rdd</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">my_schema</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Podemos então olhar nosso DataFrame e verificar que as colunas agora vêm identificadas.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------+-------+
|dept_name|dept_id|
+---------+-------+
|  Finance|     10|
|Marketing|     20|
|    Sales|     30|
|       IT|     40|
+---------+-------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Podemos também verificar o Schema do DataFrame com as características que definimos anteriormente.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf1</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>root
 |-- dept_name: string (nullable = true)
 |-- dept_id: integer (nullable = true)

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="operacoes-basicas-com-colunas">Operações básicas com colunas<a class="headerlink" href="#operacoes-basicas-com-colunas" title="Permanent link">&para;</a></h1>
<p>A exemplo do Pandas DataFrame, temos à nossa disposição uma série de transformações e ações que nos permite operar sobre o Spark DataFrame. Veremos a seguir as operações em colunas.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="columns">columns<a class="headerlink" href="#columns" title="Permanent link">&para;</a></h2>
<p>O atributo columns retorna, a exemplo do Pandas, uma lista com o nome das colunas. Contudo, diferente do Pandas, não é possível sobrescrever este atributo diretamente. </p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[&#39;_1&#39;, &#39;_2&#39;]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="withcolumnrenamed">withColumnRenamed()<a class="headerlink" href="#withcolumnrenamed" title="Permanent link">&para;</a></h2>
<p>Para renomear uma coluna utilizamos a função withColumnRenamed(). Esta função opera em uma coluna por vez. Assim, podemos utilizar um laço para renomear todas as colunas.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">old_col</span><span class="p">,</span> <span class="n">new_col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sdf</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;dept_name&#39;</span><span class="p">,</span> <span class="s1">&#39;dept_id&#39;</span><span class="p">]):</span>
    <span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">old_col</span><span class="p">,</span> <span class="n">new_col</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------+-------+
|dept_name|dept_id|
+---------+-------+
|  Finance|     10|
|Marketing|     20|
|    Sales|     30|
|       IT|     40|
+---------+-------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="drop">drop()<a class="headerlink" href="#drop" title="Permanent link">&para;</a></h2>
<p>Podemos descartar colunas usando a função .drop()</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;dept_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------+
|dept_name|
+---------+
|  Finance|
|Marketing|
|    Sales|
|       IT|
+---------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="acessando-colunas">Acessando colunas<a class="headerlink" href="#acessando-colunas" title="Permanent link">&para;</a></h2>
<p>Para acessar as colunas de um DataFrame, podemos utilizar a mesma notação python. Observe, contudo, que as colunas são representadas como objetos e, assim, o acesso à coluna não retorna automaticamente os dados existentes nela.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;dept_id&#39;</span><span class="p">]</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>Column&lt;b&#39;dept_id&#39;&gt;</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">dept_id</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>Column&lt;b&#39;dept_id&#39;&gt;</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="select">select()<a class="headerlink" href="#select" title="Permanent link">&para;</a></h2>
<p>Para acessar os dados de uma coluna específica, precisamos utilizar a transformação select() seguida de uma ação show(). Esta transformação é similiar ao SELECT em SQL.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;dept_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------+
|dept_name|
+---------+
|  Finance|
|Marketing|
|    Sales|
|       IT|
+---------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="case-sensitivity">Case sensitivity<a class="headerlink" href="#case-sensitivity" title="Permanent link">&para;</a></h2>
<p>Observe que a exemplo do SQL, DataFrames em Spark não são naturalmente sensíveis ao caso.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;DEPT_NAME&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------+
|DEPT_NAME|
+---------+
|  Finance|
|Marketing|
|    Sales|
|       IT|
+---------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;dept_NAME&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------+
|dept_NAME|
+---------+
|  Finance|
|Marketing|
|    Sales|
|       IT|
+---------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="operacoes-basicas-com-linhas">Operações básicas com linhas<a class="headerlink" href="#operacoes-basicas-com-linhas" title="Permanent link">&para;</a></h1>
<p>Da mesma forma que temos operações com colunas, temos operações com linhas.</p>
<h2 id="limit">limit()<a class="headerlink" href="#limit" title="Permanent link">&para;</a></h2>
<p>A transformação limit(LIM) nos permite limitar um número de registros (linhas no DataFrame) a ser retornado. POdemos concatenar com .collect() e temos o DataFrame no formato de RDD. </p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[Row(dept_name=&#39;Finance&#39;, dept_id=10),
 Row(dept_name=&#39;Marketing&#39;, dept_id=20),
 Row(dept_name=&#39;Sales&#39;, dept_id=30)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Com isso podemos reduzir o número de linhas do nosso DataFrame para aumentar a velocidade do nosso trabalho.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="filter-filtrando-linhas">filter() - filtrando linhas<a class="headerlink" href="#filter-filtrando-linhas" title="Permanent link">&para;</a></h2>
<p>A transformação filter() nos permite filtrar linhas com base em condições especificadas sobre colunas.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sdf</span><span class="o">.</span><span class="n">dept_id</span> <span class="o">==</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------+-------+
|dept_name|dept_id|
+---------+-------+
|Marketing|     20|
+---------+-------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="where-filtrando-linhas">where() - filtrando linhas<a class="headerlink" href="#where-filtrando-linhas" title="Permanent link">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Para manter a similaridade como o SQL, a transformação filter() também pode ser acessada através de seu apelido (alias) where().</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sdf</span><span class="o">.</span><span class="n">dept_id</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------+-------+
|dept_name|dept_id|
+---------+-------+
|  Finance|     10|
+---------+-------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="distinct-filtrando-valores-distintos">distinct() - filtrando valores distintos<a class="headerlink" href="#distinct-filtrando-valores-distintos" title="Permanent link">&para;</a></h2>
<p>Utilizamos a transformação distinct() para selecionar apenas os valores distintos de uma coluna específica.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;dept_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+-------+
|dept_id|
+-------+
|     10|
|     20|
|     30|
|     40|
+-------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="union-concatenando-linhas">union() - concatenando linhas<a class="headerlink" href="#union-concatenando-linhas" title="Permanent link">&para;</a></h2>
<p>Para concatenar linhas no DataFrame, precisamos criar uma RDD com objetos do tipo Row e Schema idêntico.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">new_rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">Row</span><span class="p">(</span><span class="n">dept_name</span> <span class="o">=</span> <span class="s1">&#39;Production&#39;</span><span class="p">,</span> <span class="n">dept_id</span> <span class="o">=</span> <span class="mi">50</span><span class="p">),</span> 
            <span class="n">Row</span><span class="p">(</span><span class="n">dept_name</span> <span class="o">=</span> <span class="s1">&#39;Human Resources&#39;</span><span class="p">,</span> <span class="n">dept_id</span> <span class="o">=</span> <span class="mi">60</span><span class="p">)]</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">new_rows</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[Row(dept_name=&#39;Production&#39;, dept_id=50),
 Row(dept_name=&#39;Human Resources&#39;, dept_id=60)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Transformamos essa lista em uma RDD, usando parallelize(), da mesma forma que fizemos anteriormente.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">parallelizedRows</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">new_rows</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Por fim, criamos o DataFrame, definindo o Schema.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">newDF</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">parallelizedRows</span><span class="p">,</span> <span class="n">my_schema</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">newDF</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------------+-------+
|      dept_name|dept_id|
+---------------+-------+
|     Production|     50|
|Human Resources|     60|
+---------------+-------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Podemos então concatenar nosso novo DataFrame ao DataFrame antigo.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf1</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">newDF</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf1</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------------+-------+
|      dept_name|dept_id|
+---------------+-------+
|        Finance|     10|
|      Marketing|     20|
|          Sales|     30|
|             IT|     40|
|     Production|     50|
|Human Resources|     60|
+---------------+-------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="orderby-ordenando-linhas">orderBy() - ordenando linhas<a class="headerlink" href="#orderby-ordenando-linhas" title="Permanent link">&para;</a></h2>
<p>Com a transformação orderBy() podemos ordenar as linhas do DataFrame. Para isso, precisamos utilizar os métodos .asc() ou .desc() na coluna chave, indicando a ordem desejada.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf1</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">sdf1</span><span class="o">.</span><span class="n">dept_id</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------------+-------+
|      dept_name|dept_id|
+---------------+-------+
|Human Resources|     60|
|     Production|     50|
|             IT|     40|
|          Sales|     30|
|      Marketing|     20|
+---------------+-------+
only showing top 5 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="pysparksqlfunctions">pyspark.sql.functions<a class="headerlink" href="#pysparksqlfunctions" title="Permanent link">&para;</a></h1>
<p>Existe uma série de funções que facilitam a manipulação de DataFrames. Elas estão disponíveis no pacote pyspark.sql.functions e podem ser investigadas na referência abaixo:</p>
<p><a href="http://spark.apache.org/docs/2.2.0/api/python/pyspark.sql.html#module-pyspark.sql.functions">http://spark.apache.org/docs/2.2.0/api/python/pyspark.sql.html#module-pyspark.sql.functions</a></p>
<p>Podemos importá-las todas através da linha de comando abaixo.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">sf</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="lit-criando-colunas">lit() - criando colunas<a class="headerlink" href="#lit-criando-colunas" title="Permanent link">&para;</a></h2>
<p>Como visto anteriormente, o Spark possui tipos próprios de dados com correspondência com o Python. Se quisermos criar uma coluna constante, podemos evitar o trabalho de criar a coluna em Python e transformá-la, utilizando a função lit(val) que cria uma coluna de literais (constantes) val.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sf</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>Column&lt;b&#39;10&#39;&gt;</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="withcolumn-adicionando-colunas">withColumn() - adicionando colunas<a class="headerlink" href="#withcolumn-adicionando-colunas" title="Permanent link">&para;</a></h2>
<p>Para isso, precisamos concatenar uma coluna de literais. Isso é feito com a transformação withColumn(nome, nova_col).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf1</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;ones&#39;</span><span class="p">,</span> <span class="n">sf</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------+-------+----+
|dept_name|dept_id|ones|
+---------+-------+----+
|  Finance|     10|   1|
|Marketing|     20|   1|
|    Sales|     30|   1|
+---------+-------+----+
only showing top 3 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="col-acessando-colunas">col() - acessando colunas<a class="headerlink" href="#col-acessando-colunas" title="Permanent link">&para;</a></h2>
<p>Em alguns casos precisamos explicitar que desejamos acessar um objeto do tipo Column. Para isso temos à nossa disposição a função .col(nome).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf1</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;dept_id&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+-------+
|dept_id|
+-------+
|     10|
|     20|
|     30|
+-------+
only showing top 3 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Observe que temos, com isso, diferentes formas de acessar colunas no select. Em alguns casos específicos será necessário optar pela menção explícita ao tipo do objeto usando .col()</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf1</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sdf1</span><span class="o">.</span><span class="n">dept_id</span><span class="p">,</span> <span class="n">sf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;dept_name&#39;</span><span class="p">),</span> <span class="s1">&#39;dept_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+-------+---------+-------+
|dept_id|dept_name|dept_id|
+-------+---------+-------+
|     10|  Finance|     10|
|     20|Marketing|     20|
|     30|    Sales|     30|
+-------+---------+-------+
only showing top 3 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Podemos ainda acessar a RDD resultante da transformação.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf1</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sdf1</span><span class="o">.</span><span class="n">dept_id</span><span class="p">,</span> <span class="n">sf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;dept_id&#39;</span><span class="p">),</span> <span class="s1">&#39;dept_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[Row(dept_id=10, dept_id=10, dept_id=10),
 Row(dept_id=20, dept_id=20, dept_id=20),
 Row(dept_id=30, dept_id=30, dept_id=30)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="alias">alias()<a class="headerlink" href="#alias" title="Permanent link">&para;</a></h2>
<p>A exemplo do SQL, podemos utilizar o método .alias() de uma coluna específica para renomear colunas rapidamente.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">sf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;dept_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;identificador&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------+-------+-------------+
|dept_name|dept_id|identificador|
+---------+-------+-------------+
|  Finance|     10|           10|
|Marketing|     20|           20|
|    Sales|     30|           30|
|       IT|     40|           40|
+---------+-------+-------------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="expressoes">Expressões<a class="headerlink" href="#expressoes" title="Permanent link">&para;</a></h1>
<p>DataFrames são equivalentes de tabelas no Pandas e também de tabelas no SQL. Buscando manter compatibilidade com o SQL, expressões permitem que escrevamos algumas expressões simplificadas de SQL para operar no DataFrame.</p>
<h2 id="expr">expr()<a class="headerlink" href="#expr" title="Permanent link">&para;</a></h2>
<p>Para isso, utilizamos a função expr(). Podemos, por exemplo, renomear colunas.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf1</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="s1">&#39;dept_name as departamento&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+------------+
|departamento|
+------------+
|     Finance|
|   Marketing|
|       Sales|
|          IT|
|  Production|
+------------+
only showing top 5 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Podemos também operar sobre colunas diretamente, a exemplo do SQL.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf1</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;dept_id&#39;</span><span class="p">,</span> <span class="s1">&#39;dept_name&#39;</span><span class="p">,</span> <span class="n">sf</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="s1">&#39;dept_id / 10&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+-------+---------+--------------+
|dept_id|dept_name|(dept_id / 10)|
+-------+---------+--------------+
|     10|  Finance|           1.0|
|     20|Marketing|           2.0|
|     30|    Sales|           3.0|
+-------+---------+--------------+
only showing top 3 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="selectexpr">selectExpr()<a class="headerlink" href="#selectexpr" title="Permanent link">&para;</a></h2>
<p>Como a combinação de .select() e .expr() é muito comum, o spark já nos fornece um atalho: selectExpr().</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">sdf</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;dept_id / 10 as `id by 10`&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+---------+-------+--------+
|dept_name|dept_id|id by 10|
+---------+-------+--------+
|  Finance|     10|     1.0|
|Marketing|     20|     2.0|
|    Sales|     30|     3.0|
|       IT|     40|     4.0|
+---------+-------+--------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="abrindo-arquivos-csv">Abrindo arquivos CSV<a class="headerlink" href="#abrindo-arquivos-csv" title="Permanent link">&para;</a></h1>
<p>Até agora trabalhamos com DataFrames criados manualmente a partir de uma RDD prévia. Podemos utilizar as funções do pacote .read do Spark para ler diretamente fontes de dados. Para carregar arquivos .csv usamos a função .csv.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s1">&#39;../10_dados/movie_lens/ratings.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>DataFrame[userId: string, movieId: string, rating: string, timestamp: string]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+------+-------+------+----------+
|userId|movieId|rating| timestamp|
+------+-------+------+----------+
|     1|    296|   5.0|1147880044|
|     1|    306|   3.5|1147868817|
|     1|    307|   5.0|1147868828|
|     1|    665|   5.0|1147878820|
|     1|    899|   3.5|1147868510|
+------+-------+------+----------+
only showing top 5 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[Row(userId=&#39;1&#39;, movieId=&#39;296&#39;, rating=&#39;5.0&#39;, timestamp=&#39;1147880044&#39;),
 Row(userId=&#39;1&#39;, movieId=&#39;306&#39;, rating=&#39;3.5&#39;, timestamp=&#39;1147868817&#39;),
 Row(userId=&#39;1&#39;, movieId=&#39;307&#39;, rating=&#39;5.0&#39;, timestamp=&#39;1147868828&#39;),
 Row(userId=&#39;1&#39;, movieId=&#39;665&#39;, rating=&#39;5.0&#39;, timestamp=&#39;1147878820&#39;),
 Row(userId=&#39;1&#39;, movieId=&#39;899&#39;, rating=&#39;3.5&#39;, timestamp=&#39;1147868510&#39;)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[&#39;userId&#39;, &#39;movieId&#39;, &#39;rating&#39;, &#39;timestamp&#39;]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[(&#39;userId&#39;, &#39;string&#39;),
 (&#39;movieId&#39;, &#39;string&#39;),
 (&#39;rating&#39;, &#39;string&#39;),
 (&#39;timestamp&#39;, &#39;string&#39;)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>root
 |-- userId: string (nullable = true)
 |-- movieId: string (nullable = true)
 |-- rating: string (nullable = true)
 |-- timestamp: string (nullable = true)

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">,</span> <span class="n">TimestampType</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">StructType</span><span class="p">,</span> <span class="n">StructField</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">labels</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;userId&#39;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">()),</span>
          <span class="p">(</span><span class="s1">&#39;movieId&#39;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">()),</span>
          <span class="p">(</span><span class="s1">&#39;rating&#39;</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">()),</span>
          <span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
         <span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">])</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>StructType(List(StructField(userId,IntegerType,true),StructField(movieId,IntegerType,true),StructField(rating,DoubleType,true),StructField(timestamp,StringType,true)))
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s1">&#39;../10_dados/movie_lens/ratings.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span> <span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>root
 |-- userId: integer (nullable = true)
 |-- movieId: integer (nullable = true)
 |-- rating: double (nullable = true)
 |-- timestamp: string (nullable = true)

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+------+-------+------+----------+
|userId|movieId|rating| timestamp|
+------+-------+------+----------+
|     1|    296|   5.0|1147880044|
|     1|    306|   3.5|1147868817|
|     1|    307|   5.0|1147868828|
|     1|    665|   5.0|1147878820|
|     1|    899|   3.5|1147868510|
+------+-------+------+----------+
only showing top 5 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;userId&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+------+
|userId|
+------+
|     1|
|     1|
|     1|
|     1|
|     1|
+------+
only showing top 5 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s1">&#39;movieId&#39;</span><span class="p">,</span> <span class="s1">&#39;rating&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+-------+------+
|movieId|rating|
+-------+------+
|    296|   5.0|
|    306|   3.5|
|    307|   5.0|
|    665|   5.0|
|    899|   3.5|
+-------+------+
only showing top 5 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">lit</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;new_column&#39;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+------+-------+------+----------+----------+
|userId|movieId|rating| timestamp|new_column|
+------+-------+------+----------+----------+
|     1|    296|   5.0|1147880044|         1|
|     1|    306|   3.5|1147868817|         1|
|     1|    307|   5.0|1147868828|         1|
|     1|    665|   5.0|1147878820|         1|
|     1|    899|   3.5|1147868510|         1|
+------+-------+------+----------+----------+
only showing top 5 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">concat</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;concat&#39;</span><span class="p">,</span> <span class="n">concat</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;movieId&#39;</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s1">&#39;rating&#39;</span><span class="p">)))</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+------+-------+------+----------+----------+-------+
|userId|movieId|rating| timestamp|new_column| concat|
+------+-------+------+----------+----------+-------+
|     1|    296|   5.0|1147880044|         1|296-5.0|
|     1|    306|   3.5|1147868817|         1|306-3.5|
|     1|    307|   5.0|1147868828|         1|307-5.0|
|     1|    665|   5.0|1147878820|         1|665-5.0|
|     1|    899|   3.5|1147868510|         1|899-3.5|
+------+-------+------+----------+----------+-------+
only showing top 5 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s1">&#39;new_column&#39;</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+------+-------+------+----------+--------+-------+
|userId|movieId|rating| timestamp|constant| concat|
+------+-------+------+----------+--------+-------+
|     1|    296|   5.0|1147880044|       1|296-5.0|
|     1|    306|   3.5|1147868817|       1|306-3.5|
|     1|    307|   5.0|1147868828|       1|307-5.0|
|     1|    665|   5.0|1147878820|       1|665-5.0|
|     1|    899|   3.5|1147868510|       1|899-3.5|
+------+-------+------+----------+--------+-------+
only showing top 5 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s1">&#39;movieId&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+-------+-----+
|movieId|count|
+-------+-----+
|   1088|11935|
|   1580|40308|
|   3175|14659|
|  44022| 4833|
| 175197|  610|
+-------+-----+
only showing top 5 rows

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>25000095</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s1">&#39;movielens&#39;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;select * from movielens limit 5&#39;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">query</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;formatted&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>== Physical Plan ==
CollectLimit (3)
+- * Project (2)
   +- Scan csv  (1)


(1) Scan csv 
Output [4]: [userId#191, movieId#192, rating#193, timestamp#194]
Batched: false
Location: InMemoryFileIndex [file:/data/aluno/shared/10_dados/movie_lens/ratings.csv]
ReadSchema: struct&lt;userId:int,movieId:int,rating:double,timestamp:string&gt;

(2) Project [codegen id : 1]
Output [6]: [userId#191, movieId#192, rating#193, timestamp#194, 1 AS constant#334, concat(cast(movieId#192 as string), -, cast(rating#193 as string)) AS concat#298]
Input [4]: [userId#191, movieId#192, rating#193, timestamp#194]

(3) CollectLimit
Input [6]: [userId#191, movieId#192, rating#193, timestamp#194, constant#334, concat#298]
Arguments: 5


</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">query</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+------+-------+------+----------+--------+-------+
|userId|movieId|rating| timestamp|constant| concat|
+------+-------+------+----------+--------+-------+
|     1|    296|   5.0|1147880044|       1|296-5.0|
|     1|    306|   3.5|1147868817|       1|306-3.5|
|     1|    307|   5.0|1147868828|       1|307-5.0|
|     1|    665|   5.0|1147878820|       1|665-5.0|
|     1|    899|   3.5|1147868510|       1|899-3.5|
+------+-------+------+----------+--------+-------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;select movieId, count(*)</span>
<span class="s2">                     from movielens </span>
<span class="s2">                     where rating = 5</span>
<span class="s2">                     group by movieId </span>
<span class="s2">                     order by 2 desc </span>
<span class="s2">                     limit 5&quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">query</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;formatted&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>== Physical Plan ==
TakeOrderedAndProject (7)
+- * HashAggregate (6)
   +- Exchange (5)
      +- * HashAggregate (4)
         +- * Project (3)
            +- * Filter (2)
               +- Scan csv  (1)


(1) Scan csv 
Output [2]: [movieId#192, rating#193]
Batched: false
Location: InMemoryFileIndex [file:/data/aluno/shared/10_dados/movie_lens/ratings.csv]
PushedFilters: [IsNotNull(rating), EqualTo(rating,5.0)]
ReadSchema: struct&lt;movieId:int,rating:double&gt;

(2) Filter [codegen id : 1]
Input [2]: [movieId#192, rating#193]
Condition : (isnotnull(rating#193) AND (rating#193 = 5.0))

(3) Project [codegen id : 1]
Output [1]: [movieId#192]
Input [2]: [movieId#192, rating#193]

(4) HashAggregate [codegen id : 1]
Input [1]: [movieId#192]
Keys [1]: [movieId#192]
Functions [1]: [partial_count(1)]
Aggregate Attributes [1]: [count#463L]
Results [2]: [movieId#192, count#464L]

(5) Exchange
Input [2]: [movieId#192, count#464L]
Arguments: hashpartitioning(movieId#192, 200), true, [id=#334]

(6) HashAggregate [codegen id : 2]
Input [2]: [movieId#192, count#464L]
Keys [1]: [movieId#192]
Functions [1]: [count(1)]
Aggregate Attributes [1]: [count(1)#458L]
Results [2]: [movieId#192, count(1)#458L AS count(1)#459L]

(7) TakeOrderedAndProject
Input [2]: [movieId#192, count(1)#459L]
Arguments: 5, [count(1)#459L DESC NULLS LAST], [movieId#192, count(1)#459L]


</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">query</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>+-------+--------+
|movieId|count(1)|
+-------+--------+
|    318|   39553|
|    296|   32169|
|    356|   25918|
|    260|   25804|
|   2571|   25482|
+-------+--------+

</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;spark.sql.repl.eagerEval.enabled&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">query</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1">
<tr><th>movieId</th><th>count(1)</th></tr>
<tr><td>318</td><td>39553</td></tr>
<tr><td>296</td><td>32169</td></tr>
<tr><td>356</td><td>25918</td></tr>
<tr><td>260</td><td>25804</td></tr>
<tr><td>2571</td><td>25482</td></tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">query</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1">
<tr><th>movieId</th><th>count(1)</th></tr>
<tr><td>318</td><td>39553</td></tr>
<tr><td>296</td><td>32169</td></tr>
<tr><td>356</td><td>25918</td></tr>
<tr><td>260</td><td>25804</td></tr>
<tr><td>2571</td><td>25482</td></tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">query</span><span class="o">.</span><span class="n">explain</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>== Physical Plan ==
TakeOrderedAndProject(limit=5, orderBy=[count(1)#459L DESC NULLS LAST], output=[movieId#192,count(1)#459L])
+- *(2) HashAggregate(keys=[movieId#192], functions=[count(1)])
   +- Exchange hashpartitioning(movieId#192, 200), true, [id=#334]
      +- *(1) HashAggregate(keys=[movieId#192], functions=[partial_count(1)])
         +- *(1) Project [movieId#192]
            +- *(1) Filter (isnotnull(rating#193) AND (rating#193 = 5.0))
               +- FileScan csv [movieId#192,rating#193] Batched: false, DataFilters: [isnotnull(rating#193), (rating#193 = 5.0)], Format: CSV, Location: InMemoryFileIndex[file:/data/aluno/shared/10_dados/movie_lens/ratings.csv], PartitionFilters: [], PushedFilters: [IsNotNull(rating), EqualTo(rating,5.0)], ReadSchema: struct&lt;movieId:int,rating:double&gt;


</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">query</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1">
<tr><th>movieId</th><th>count(1)</th></tr>
<tr><td>318</td><td>39553</td></tr>
<tr><td>296</td><td>32169</td></tr>
<tr><td>356</td><td>25918</td></tr>
<tr><td>260</td><td>25804</td></tr>
<tr><td>2571</td><td>25482</td></tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">query</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1">
<tr><th>movieId</th><th>count(1)</th></tr>
<tr><td>318</td><td>39553</td></tr>
<tr><td>296</td><td>32169</td></tr>
<tr><td>356</td><td>25918</td></tr>
<tr><td>260</td><td>25804</td></tr>
<tr><td>2571</td><td>25482</td></tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code>
</code></pre></div>

</div>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href=".." class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              Home
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "search.config.lang": "pt", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Buscar", "search.result.placeholder": "Digite para iniciar a busca", "search.result.none": "Nenhum resultado encontrado", "search.result.one": "1 resultado encontrado", "search.result.other": "# resultados encontrados", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.4fa0e4ee.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.1d3bfcf1.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.0.0/js-yaml.min.js"></script>
      
        <script src="../js/markdown-enhancer.js"></script>
      
    
  </body>
</html>